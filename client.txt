import java.io.*;
import java.net.*;

public class Client {

    private String host;
    private int port;
    private Socket socket;
    private BufferedReader in;
    private PrintWriter out;
    private String key = "12345";

    public Client(String host, int port) throws Exception {
        this.host = host;
        this.port = port;

        socket = new Socket(host, port);
        in = new BufferedReader(new InputStreamReader(socket.getInputStream()));
        out = new PrintWriter(socket.getOutputStream());
    }

    public Socket getSocket() {
        return socket;
    }

    // send handshake key to server
    public void handshake() {
        out.println(key);
        out.flush();
    }

    // send request, wait for reply
    public String request(String msg) {
        try {
            out.println(msg);
            out.flush();
            return in.readLine();
        } catch (Exception e) {
            return "An exception happened.";
        }
    }

    public void disconnect() {
        try {
            in.close();
        } catch (Exception e) {
        }
        try {
            out.close();
        } catch (Exception e) {
        }
        try {
            socket.close();
        } catch (Exception e) {
        }
    }
}
Server code 
import java.io.*;
import java.net.*;
import java.time.*;
import java.util.ArrayList;

public class Server {

    private int port;
    private ServerSocket serverSocket;
    private ArrayList<Socket> clients = new ArrayList<>();
    private ArrayList<LocalDateTime> connectedTimes = new ArrayList<>();

    public Server(int port) throws Exception {
        this.port = port;
        serverSocket = new ServerSocket(port);
    }

    // Accept exactly num clients and spawn a thread for each
    public void serve(int num) {
        try {
            for (int i = 0; i < num; i++) {
                Socket s = serverSocket.accept();
                clients.add(s);

                Thread t = new Thread(() -> handleClient(s));
                t.start();
            }
        } catch (Exception e) {
            // ignore
        }
    }

    private void handleClient(Socket s) {
        try {
            BufferedReader in = new BufferedReader(new InputStreamReader(s.getInputStream()));
            PrintWriter out = new PrintWriter(s.getOutputStream());

            String handshake = in.readLine();

            if (!"12345".equals(handshake)) {
                out.println("couldn't handshake");
                out.flush();
                s.close();
                return;
            }

            // valid handshake response
            out.println("12345");
            out.flush();

            // Record connection time
            connectedTimes.add(LocalDateTime.now());
            String req = in.readLine();
            long n;

            try {
                n = Long.parseLong(req);
            } catch (Exception ex) {
                out.println("There was an exception on the server");
                out.flush();
                return;
            }

            long f = countFactors(n);
            out.println("The number " + n + " has " + f + " factors");
            out.flush();

        } catch (Exception e) {
            try {
                PrintWriter out = new PrintWriter(s.getOutputStream());
                out.println("There was an exception on the server");
                out.flush();
            } catch (Exception ignore) {
            }
        }
    }

    private long countFactors(long n) {
        long count = 0;
        long limit = (long) Math.sqrt(n);

        for (long i = 1; i <= limit; i++) {
            if (n % i == 0)
                count += 2;
        }
        if (limit * limit == n)
            count--; // perfect square fix

        return count;
    }

    public ArrayList<LocalDateTime> getConnectedTimes() {
        return connectedTimes;
    }

    public void disconnect() {
        try {
            serverSocket.close();
        } catch (Exception e) {
        }

        for (Socket s : clients) {
            try {
                s.close();
            } catch (Exception e) {
            }
        }
    }
}
lab14 tester code
import org.junit.Test;
import static org.junit.Assert.assertEquals;
import java.util.*;
import java.io.*;
import java.net.*;
import java.time.*;

public class Lab14_Tester {

  @Test
  public void test1() {
    System.out.println("checking client constructor");

    ServerSocket serverSocket = null;
    try{
        serverSocket = new ServerSocket(2021);
    }
    catch (Exception e) {
        System.err.print("Could not open serverSocket");
        e.printStackTrace();
    }

    String line = "An exception happened.";
    try {
        Client client = new Client("localhost", 2021);
        assertEquals("/127.0.0.1", client.getSocket().getLocalAddress().toString());
        assertEquals(2021, client.getSocket().getPort());
        Socket remote = serverSocket.accept();
        client.handshake();
        Thread.sleep(1000); // give it a second to actually flush
        BufferedReader incoming = new BufferedReader(new InputStreamReader(remote.getInputStream()));
        line = incoming.readLine();
        incoming.close();
        remote.close();
        client.disconnect();
    } catch (Exception e){
        e.printStackTrace();
    }

    try{
        serverSocket.close();
    } catch (Exception e){
        e.printStackTrace();
    }

    assertEquals("12345", line);

  }

  @Test
  public void test2() {
    System.out.println("checking client communication with server for small number");

    Server server = null;
    try{
        server = new Server(2021);
    }
    catch (Exception e) {
        System.err.print("Could not open server");
        e.printStackTrace();
    }

    String line = "An exception happened.";
    try {
        Client client = new Client("localhost", 2021);

        client.handshake();
        Thread.sleep(1000); // give it a second to actually flush

        server.serve(1);
        Thread.sleep(1000); // give it a second to actually flush

        line = client.request("17");
        Thread.sleep(1000); // give it a second to actually flush

    } catch (Exception e){
        e.printStackTrace();
    }
    server.disconnect();
    assertEquals("The number 17 has 2 factors", line);
  }

  @Test
  public void test3() {
    System.out.println("checking client communication with server for medium number");

    Server server = null;
    try{
        server = new Server(2021);
    }
    catch (Exception e) {
        System.err.print("Could not open server");
        e.printStackTrace();
    }

    String line = "An exception happened.";
    try {
        Client client = new Client("localhost", 2021);

        client.handshake();
        Thread.sleep(1000); // give it a second to actually flush

        server.serve(1);
        Thread.sleep(1000); // give it a second to actually flush

        Integer number = 2*3*4*5*6*7*8*9;
        line = client.request(number.toString());
        Thread.sleep(1000); // give it a second to actually flush

    } catch (Exception e){
        e.printStackTrace();
    }
    server.disconnect();
    assertEquals("The number 362880 has 160 factors", line);
  }

  @Test
  public void test4() {
    System.out.println("checking client communication with server for large number");

    Server server = null;
    try{
        server = new Server(2021);
    }
    catch (Exception e) {
        System.err.print("Could not open server");
        e.printStackTrace();
    }

    String line = "An exception happened.";
    try {
        Client client = new Client("localhost", 2021);

        client.handshake();
        Thread.sleep(1000); // give it a second to actually flush

        server.serve(1);
        Thread.sleep(1000); // give it a second to actually flush

        line = client.request("2147483642");
        Thread.sleep(1000); // give it a second to actually flush

    } catch (Exception e){
        e.printStackTrace();
    }
    server.disconnect();
    assertEquals("The number 2147483642 has 8 factors", line);
  }

  @Test
  public void test5() {
    System.out.println("checking client communication with server for too large number");

    Server server = null;
    try{
        server = new Server(2021);
    }
    catch (Exception e) {
        System.err.print("Could not open server");
        e.printStackTrace();
    }

    String line = "An exception happened.";
    try {
        Client client = new Client("localhost", 2021);

        client.handshake();
        Thread.sleep(1000); // give it a second to actually flush

        server.serve(1);
        Thread.sleep(1000); // give it a second to actually flush

        line = client.request("92147483642");
        Thread.sleep(1000); // give it a second to actually flush

    } catch (Exception e){
        e.printStackTrace();
    }
    server.disconnect();
    assertEquals("There was an exception on the server", line);
  }

  @Test
  public void test6() {
    System.out.println("checking two client communication with server for medium number");

    Server server = null;
    try{
        server = new Server(2021);
    }
    catch (Exception e) {
        System.err.print("Could not open server");
        e.printStackTrace();
    }

    String line = "An exception happened.";
    try {
        Client client1 = new Client("localhost", 2021);
        Client client2 = new Client("localhost", 2021);

        client1.handshake();
        client2.handshake();
        Thread.sleep(1000); // give it a second to actually flush

        server.serve(2);
        Thread.sleep(1000); // give it a second to actually flush

        line = client1.request("47483647");
        Thread.sleep(1000); // give it a second to actually flush

        line += "\t" + client2.request("362880");
        Thread.sleep(1000); // give it a second to actually flush

    } catch (Exception e){
        e.printStackTrace();
    }
    server.disconnect();
    assertEquals("The number 47483647 has 4 factors\tThe number 362880 has 160 factors", line);
  }

  @Test
  public void test7() {
    System.out.println("checking eight clients communication with server for large number");

    Server server = null;
    try{
        server = new Server(2021);
    }
    catch (Exception e) {
        System.err.print("Could not open server");
        e.printStackTrace();
    }

    String line = "An exception happened.";
    try {
        Client client1 = new Client("localhost", 2021);
        Client client2 = new Client("localhost", 2021);
        Client client3 = new Client("localhost", 2021);
        Client client4 = new Client("localhost", 2021);
        Client client5 = new Client("localhost", 2021);
        Client client6 = new Client("localhost", 2021);
        Client client7 = new Client("localhost", 2021);
        Client client8 = new Client("localhost", 2021);

        client1.handshake();
        client2.handshake();
        client3.handshake();
        client4.handshake();
        client5.handshake();
        client6.handshake();
        client7.handshake();
        client8.handshake();
        Thread.sleep(1000); // give it a second to actually flush

        server.serve(8);
        Thread.sleep(1000); // give it a second to actually flush

        line = client8.request("2147483642");
        line += "\t" + client7.request("2147483642");
        line += "\t" + client6.request("2147483642");
        line += "\t" + client5.request("2147483642"); 
        line += "\t" + client4.request("2147483642"); 
        line += "\t" + client3.request("2147483642");
        line += "\t" + client2.request("2147483642");
        line += "\t" + client1.request("2147483642");      

        Thread.sleep(1000); // give it a second to actually flush

        ArrayList<LocalDateTime> times = server.getConnectedTimes();
        Duration duration = Duration.between(times.get(0), times.get(times.size()-1));
        long seconds = duration.toMillis();
        System.out.println("toMillis: " + seconds);
        assertEquals(500, seconds, 500);

    } catch (Exception e){
        e.printStackTrace();
    }
    server.disconnect();
    assertEquals("The number 2147483642 has 8 factors\tThe number 2147483642 has 8 factors\tThe number 2147483642 has 8 factors\tThe number 2147483642 has 8 factors\tThe number 2147483642 has 8 factors\tThe number 2147483642 has 8 factors\tThe number 2147483642 has 8 factors\tThe number 2147483642 has 8 factors", line);
  }

  @Test
  public void test8() {
    System.out.println("checking server incorrect handshake recieved");

     Server server = null;
    try{
        server = new Server(2021);
    }
    catch (Exception e) {
        System.err.print("Could not open server");
        e.printStackTrace();
    }

    String line = "An exception happened.";
    try {
        Socket client = new Socket("localhost", 2021);
        PrintWriter out = new PrintWriter(client.getOutputStream());
        BufferedReader in = new BufferedReader(new InputStreamReader(client.getInputStream()));
        out.println("1234555555");
        out.flush();
        System.out.println("handshake sent");
        Thread.sleep(1000); // give it a second to actually flush

        server.serve(1);
        Thread.sleep(1000); // give it a second to actually flush

        line = in.readLine();
        in.close();
        client.close();
    } catch (Exception e){
        e.printStackTrace();
    }

    try{
        server.disconnect();
    } catch (Exception e){
        e.printStackTrace();
    }

    assertEquals("couldn't handshake", line);

  }
}
